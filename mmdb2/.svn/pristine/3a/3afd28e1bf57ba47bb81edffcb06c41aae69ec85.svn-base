(function(graph, self){

    'use strict';

	self.views = [];

    graph.onload = function(){
        var list = [], result, data;

		self.webglContainer = $(document.body);

        $(document.body).width($(window).width());
        $(document.body).height($(window).height());

		self.view = urlParams.view;
        result = graph.api.getPortfolio(self.view);


        if(graph.utils.isTrueRet(result)){

			data = JSON.parse(result.data.content);

			$.each(data.d2setting.views, function(){
				var viewid = this, result, o;
				result = graph.api.getView(viewid);
				if(result.success){
					list.push({
						id: result.data._neo4jid_,
						name: [result.data._category_, result.data.name].join(' | '),
						img: result.data.imageUrl,
						xml: result.data.xml
					});

					o = JSON.parse(result.data.svg);
					o.name =  result.data.viewname;
					o.viewid = result.data.viewid;
					o.xml = result.xml;

					self.views.push(o);
				}

			});

			self.outline = new graph.Outline(list, document.body, data.d2setting);
        }else{
            graph.utils.alert(result.message);
        }
    };

})(nameSpace.reg('graph'), nameSpace.reg('graph.ote'));
